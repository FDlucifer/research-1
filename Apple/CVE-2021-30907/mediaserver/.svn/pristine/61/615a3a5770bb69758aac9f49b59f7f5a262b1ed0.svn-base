#include "mem_util.h"

#include <stdio.h>
#include <stdlib.h>

static int mem_addr_compare(const void *val1, const void *val2) {
    const uint64_t *p1 = val1;
    const uint64_t *p2 = val2;
    if (*p1 < *p2)
        return -1;
    else if (*p1 == *p2)
        return 0;
    else
        return 1;
}

void merge_mem_segments(uint64_t *addresses, uint32_t count, uint64_t gap) {

    qsort(addresses, count, sizeof(uint64_t), mem_addr_compare);

    uint64_t last_start = 0x00;
    uint64_t last_end = 0x00;
    for (size_t i = 0; i < count; i++) {
        if (addresses[i] != last_end) {
            if (i != 0) printf("[*] 0x%llx-0x%llx\n", last_start, last_end);
            last_start = addresses[i];
            last_end = addresses[i] + gap;
        } else {
            last_end = addresses[i] + gap;
        }
    }
    printf("[*] 0x%llx-0x%llx\n", last_start, last_end);
}
